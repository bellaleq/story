<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم مدیریت فروشگاه - نسخه ابری</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="ti ti-shopping-cart"></i>
                    سیستم مدیریت فروشگاه
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div id="userName"></div>
                    <div class="user-avatar" id="userAvatar"></div>
                    <button id="userLogout" class="btn-danger">
                        <i class="ti ti-logout"></i>
                        خروج
                    </button>
                    <button id="adminLogout" class="btn-danger" style="display: none;">
                        <i class="ti ti-logout"></i>
                        خروج مدیر
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- صفحه ورود -->
        <div id="loginPage" class="page">
            <div class="auth-container">
                <div class="auth-header">
                    <h2>ورود به سیستم</h2>
                    <p>سیستم مدیریت چند فروشگاهی</p>
                </div>
                
                <div class="tabs">
                    <div class="tab active" id="userLoginTab">ورود فروشگاه</div>
                    <div class="tab" id="adminLoginTab">ورود مدیر</div>
                </div>
                
                <form id="userLoginForm">
                    <div class="form-group">
                        <label for="userEmail">ایمیل:</label>
                        <input type="email" id="userEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="userPassword">رمز عبور:</label>
                        <input type="password" id="userPassword" required>
                    </div>
                    <button type="submit" class="btn-primary" style="width: 100%;">
                        <i class="ti ti-login"></i>
                        ورود
                    </button>
                </form>
                
                <form id="adminLoginForm" style="display: none;">
                    <div class="form-group">
                        <label for="adminEmail">ایمیل مدیر:</label>
                        <input type="email" id="adminEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">رمز عبور مدیر:</label>
                        <input type="password" id="adminPassword" required>
                    </div>
                    <button type="submit" class="btn-primary" style="width: 100%;">
                        <i class="ti ti-login"></i>
                        ورود مدیر
                    </button>
                </form>
                
                <div style="text-align: center; margin-top: 20px;">
                    <span>حساب کاربری ندارید؟ </span>
                    <button id="showRegisterForm" class="btn-info" style="padding: 5px 10px;">
                        <i class="ti ti-user-plus"></i>
                        ثبت نام
                    </button>
                </div>
            </div>
        </div>

        <!-- صفحه ثبت نام -->
        <div id="registerPage" class="page hidden">
            <div class="auth-container">
                <div class="auth-header">
                    <h2>ثبت نام فروشگاه جدید</h2>
                    <p>فرم ثبت نام فروشگاه در سیستم</p>
                </div>
                
                <form id="registerForm">
                    <div class="form-group">
                        <label for="storeName">نام فروشگاه:</label>
                        <input type="text" id="storeName" required>
                    </div>
                    <div class="form-group">
                        <label for="ownerName">نام صاحب فروشگاه:</label>
                        <input type="text" id="ownerName" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">ایمیل:</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">رمز عبور:</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">تکرار رمز عبور:</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <button type="submit" class="btn-primary" style="width: 100%;">
                        <i class="ti ti-user-plus"></i>
                        ثبت نام
                    </button>
                </form>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button id="backToLogin" class="btn-info" style="width: 100%;">
                        <i class="ti ti-arrow-back"></i>
                        بازگشت به صفحه ورود
                    </button>
                </div>
            </div>
        </div>

        <!-- داشبورد کاربر -->
        <div id="userDashboard" class="page hidden">
            <div id="pendingApproval" class="notification warning" style="position: relative; margin-bottom: 20px; display: none;">
                حساب شما در انتظار تأیید مدیر است. پس از تأیید میتوانید از امکانات سیستم استفاده کنید.
            </div>
            
            <div id="userDashboardContent">
                <div class="user-info-bar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h2 id="userStoreName">فروشگاه</h2>
                        <div id="userStatus"></div>
                    </div>
                    <div class="user-actions" style="display: flex; gap: 10px;">
                        <button id="backupData" class="btn-info">
                            <i class="ti ti-download"></i>
                            پشتیبانگیری
                        </button>
                        <button id="printProducts" class="btn-info">
                            <i class="ti ti-printer"></i>
                            چاپ محصولات
                        </button>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ti ti-package"></i>
                        </div>
                        <div class="stat-number" id="totalProducts">0</div>
                        <div>کل محصولات</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ti ti-category"></i>
                        </div>
                        <div class="stat-number" id="totalCategories">0</div>
                        <div>دستهبندیها</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ti ti-box"></i>
                        </div>
                        <div class="stat-number" id="totalParents">0</div>
                        <div>محصولات اصلی</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ti ti-shopping-cart"></i>
                        </div>
                        <div class="stat-number" id="totalSold">0</div>
                        <div>فروش امروز</div>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="products">محصولات</div>
                    <div class="tab" data-tab="categories">دستهبندیها</div>
                    <div class="tab" data-tab="sales">فروشها</div>
                    <div class="tab" data-tab="settings">تنظیمات</div>
                </div>
                
                <!-- تب محصولات -->
                <div id="userProductsTab" class="user-tab">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>لیست محصولات</h3>
                            <div>
                                <button id="exportProducts" class="btn-info">
                                    <i class="ti ti-download"></i>
                                    خروجی
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>نام محصول</th>
                                    <th>دستهبندی</th>
                                    <th>قیمت (افغانی)</th>
                                    <th>محصول والد</th>
                                    <th>وضعیت</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- محصولات اینجا نمایش داده میشوند -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3>افزودن محصول جدید</h3>
                        </div>
                        <form id="productForm" style="padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="productName">نام محصول:</label>
                                    <input type="text" id="productName" required>
                                </div>
                                <div class="form-group">
                                    <label for="productCategory">دستهبندی:</label>
                                    <select id="productCategory" required>
                                        <option value="">انتخاب کنید</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="productPrice">قیمت (افغانی):</label>
                                    <input type="number" id="productPrice" required>
                                </div>
                                <div class="form-group">
                                    <label for="productParent">محصول والد:</label>
                                    <select id="productParent">
                                        <option value="">هیچکدام (محصول اصلی)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="productDescription">توضیحات:</label>
                                <textarea id="productDescription" rows="3"></textarea>
                            </div>
                            <button type="submit" class="btn-primary">
                                <i class="ti ti-plus"></i>
                                افزودن محصول
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- تب دستهبندیها -->
                <div id="userCategoriesTab" class="user-tab hidden">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>لیست دستهبندیها</h3>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>نام دستهبندی</th>
                                    <th>دستهبندی والد</th>
                                    <th>تعداد محصولات</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTableBody">
                                <!-- دستهبندیها اینجا نمایش داده میشوند -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3>افزودن دستهبندی جدید</h3>
                        </div>
                        <form id="categoryForm" style="padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="categoryName">نام دستهبندی:</label>
                                    <input type="text" id="categoryName" required>
                                </div>
                                <div class="form-group">
                                    <label for="categoryParent">دستهبندی والد:</label>
                                    <select id="categoryParent">
                                        <option value="">هیچکدام (دستهبندی اصلی)</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">
                                <i class="ti ti-plus"></i>
                                افزودن دستهبندی
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- تب فروشها -->
                <div id="userSalesTab" class="user-tab hidden">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>فروشهای امروز</h3>
                        </div>
                        <div id="soldItemsList" style="padding: 20px;">
                            <!-- فروشهای امروز اینجا نمایش داده میشوند -->
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3>ثبت فروش جدید</h3>
                        </div>
                        <div style="padding: 20px;">
                            <div id="productsChecklist">
                                <!-- لیست محصولات برای انتخاب -->
                            </div>
                            <button id="markAsSold" class="btn-success" style="margin-top: 15px;">
                                <i class="ti ti-shopping-cart"></i>
                                ثبت به عنوان فروخته شده
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- تب تنظیمات -->
                <div id="userSettingsTab" class="user-tab hidden">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>تنظیمات تلگرام</h3>
                        </div>
                        <div style="padding: 20px;">
                            <div class="form-group">
                                <label for="userTelegramToken">توکن ربات تلگرام:</label>
                                <input type="text" id="userTelegramToken" placeholder="توکن ربات تلگرام خود را وارد کنید">
                            </div>
                            <div class="form-group">
                                <label for="userTelegramChatId">Chat ID:</label>
                                <input type="text" id="userTelegramChatId" placeholder="Chat ID خود را وارد کنید">
                            </div>
                            <div id="telegramStatus" class="telegram-status">
                                <span id="telegramStatusText">آماده</span>
                            </div>
                            <button id="saveTelegramSettings" class="btn-primary">
                                <i class="ti ti-device-floppy"></i>
                                ذخیره تنظیمات تلگرام
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3>مدیریت دادهها</h3>
                        </div>
                        <div style="padding: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button id="restoreData" class="btn-warning">
                                <i class="ti ti-upload"></i>
                                بازیابی
                            </button>
                            <input type="file" id="restoreFile" accept=".json" style="display: none;">
                            <button id="clearData" class="btn-danger">
                                <i class="ti ti-trash"></i>
                                پاک کردن تمام دادهها
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3>گزارشگیری</h3>
                        </div>
                        <div style="padding: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button id="printCategories" class="btn-info">
                                <i class="ti ti-printer"></i>
                                چاپ دستهبندیها
                            </button>
                            <button id="printSales" class="btn-info">
                                <i class="ti ti-printer"></i>
                                چاپ فروشها
                            </button>
                            <button id="printInventory" class="btn-info">
                                <i class="ti ti-printer"></i>
                                چاپ موجودی
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- داشبورد مدیر -->
        <div id="adminDashboard" class="page hidden">
            <div class="user-info-bar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>پنل مدیریت سیستم</h2>
                <div class="user-actions" style="display: flex; gap: 10px;">
                    <button id="backupAllData" class="btn-info">
                        <i class="ti ti-download"></i>
                        پشتیبانگیری کلی
                    </button>
                    <button id="createStoreAccount" class="btn-primary">
                        <i class="ti ti-plus"></i>
                        ایجاد فروشگاه
                    </button>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="ti ti-building-store"></i>
                    </div>
                    <div class="stat-number" id="adminTotalStores">0</div>
                    <div>فروشگاهها</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="ti ti-package"></i>
                    </div>
                    <div class="stat-number" id="adminTotalProducts">0</div>
                    <div>کل محصولات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="ti ti-shopping-cart"></i>
                    </div>
                    <div class="stat-number" id="adminTotalSales">0</div>
                    <div>فروشها</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="ti ti-user-plus"></i>
                    </div>
                    <div class="stat-number" id="adminNewStores">0</div>
                    <div>فروشگاههای جدید</div>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="stores">مدیریت فروشگاهها</div>
                <div class="tab" data-tab="approvals">درخواستهای تأیید</div>
                <div class="tab" data-tab="credentials">اطلاعات کاربران</div>
                <div class="tab" data-tab="system">تنظیمات سیستم</div>
            </div>
            
            <!-- تب مدیریت فروشگاهها -->
            <div id="adminStoresTab" class="admin-tab">
                <div id="storesList">
                    <!-- لیست فروشگاهها اینجا نمایش داده میشوند -->
                </div>
            </div>
            
            <!-- تب درخواستهای تأیید -->
            <div id="adminApprovalsTab" class="admin-tab hidden">
                <h3 style="margin-bottom: 20px;">درخواستهای در انتظار تأیید</h3>
                
                <div id="approvalList">
                    <!-- درخواستهای تأیید اینجا نمایش داده میشوند -->
                </div>
            </div>
            
            <!-- تب اطلاعات کاربران -->
            <div id="adminCredentialsTab" class="admin-tab hidden">
                <h3 style="margin-bottom: 20px;">اطلاعات کاربران سیستم</h3>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>نام فروشگاه</th>
                                <th>صاحب فروشگاه</th>
                                <th>ایمیل</th>
                                <th>رمز عبور</th>
                                <th>وضعیت</th>
                                <th>تاریخ ثبتنام</th>
                            </tr>
                        </thead>
                        <tbody id="userCredentialsTable">
                            <!-- اطلاعات کاربران اینجا نمایش داده میشوند -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- تب تنظیمات سیستم -->
            <div id="adminSystemTab" class="admin-tab hidden">
                <h3 style="margin-bottom: 20px;">تنظیمات و مدیریت سیستم</h3>
                
                <div class="table-container">
                    <div style="padding: 20px;">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                            <button id="resetAllData" class="btn-danger">
                                <i class="ti ti-refresh"></i>
                                بازنشانی تمام دادهها
                            </button>
                            <button id="viewAllData" class="btn-warning">
                                <i class="ti ti-database"></i>
                                مشاهده تمام دادهها
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label>اطلاعات مدیر سیستم:</label>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-top: 8px;">
                                <div><strong>ایمیل:</strong> admin@example.com</div>
                                <div><strong>رمز عبور:</strong> admin123</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- مودالها -->
    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ویرایش محصول</h3>
                <span class="close-modal">&times;</span>
            </div>
            <form id="editProductForm">
                <input type="hidden" id="editProductId">
                <div class="form-group">
                    <label for="editProductName">نام محصول:</label>
                    <input type="text" id="editProductName" required>
                </div>
                <div class="form-group">
                    <label for="editProductCategory">دستهبندی:</label>
                    <select id="editProductCategory" required>
                        <option value="">انتخاب کنید</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editProductPrice">قیمت (افغانی):</label>
                    <input type="number" id="editProductPrice" required>
                </div>
                <div class="form-group">
                    <label for="editProductParent">محصول والد:</label>
                    <select id="editProductParent">
                        <option value="">هیچکدام (محصول اصلی)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editProductDescription">توضیحات:</label>
                    <textarea id="editProductDescription" rows="3"></textarea>
                </div>
                <button type="submit" class="btn-primary">
                    <i class="ti ti-device-floppy"></i>
                    ذخیره تغییرات
                </button>
            </form>
        </div>
    </div>

    <div id="createStoreModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ایجاد حساب فروشگاه جدید</h3>
                <span class="close-modal">&times;</span>
            </div>
            <form id="createStoreForm">
                <div class="form-group">
                    <label for="newStoreName">نام فروشگاه:</label>
                    <input type="text" id="newStoreName" required>
                </div>
                <div class="form-group">
                    <label for="newOwnerName">نام صاحب فروشگاه:</label>
                    <input type="text" id="newOwnerName" required>
                </div>
                <div class="form-group">
                    <label for="newStoreEmail">ایمیل:</label>
                    <input type="email" id="newStoreEmail" required>
                </div>
                <div class="form-group">
                    <label for="newStorePassword">رمز عبور:</label>
                    <input type="password" id="newStorePassword" required>
                </div>
                <button type="submit" class="btn-primary">
                    <i class="ti ti-plus"></i>
                    ایجاد حساب
                </button>
            </form>
        </div>
    </div>

    <!-- ناحیه چاپ -->
    <div id="printArea" class="print-area"></div>

    <!-- بارگذاری Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
</body>
</html>

